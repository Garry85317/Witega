<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>產品管理後台 - Witega</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f5f5f5;
        padding-top: 20px;
      }
      .admin-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .login-container {
        max-width: 400px;
        margin: 100px auto;
      }
      .login-card {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      #loginForm {
        display: none;
      }
      #adminContent {
        display: none;
      }
      .card {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .image-preview {
        margin: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
      }
      .image-preview img {
        object-fit: contain;
        border-radius: 4px;
      }
      .spec-item {
        background: #f8f9fa;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        border-left: 3px solid #5846f9;
      }
      .btn-remove {
        color: #dc3545;
        cursor: pointer;
      }
      .btn-remove:hover {
        color: #c82333;
      }
    </style>
  </head>
  <body>
    <!-- 登入表單 -->
    <div class="login-container" id="loginForm">
      <div class="card login-card">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0"><i class="bi bi-lock"></i> 登入後台</h3>
        </div>
        <div class="card-body">
          <form id="loginFormElement" onsubmit="handleLogin(event)">
            <div class="mb-3">
              <label for="username" class="form-label">帳號</label>
              <input
                type="text"
                class="form-control"
                id="username"
                required
                autocomplete="username"
              />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">密碼</label>
              <input
                type="password"
                class="form-control"
                id="password"
                required
                autocomplete="current-password"
              />
            </div>
            <div
              id="loginError"
              class="alert alert-danger"
              style="display: none"
            ></div>
            <button type="submit" class="btn btn-primary w-100">
              <i class="bi bi-box-arrow-in-right"></i> 登入
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- 後台內容 -->
    <div class="admin-container" id="adminContent">
      <div class="card">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h3 class="mb-0"><i class="bi bi-box-seam"></i> 產品管理後台</h3>
          <button class="btn btn-sm btn-light" onclick="handleLogout()">
            <i class="bi bi-box-arrow-right"></i> 登出
          </button>
        </div>
        <div class="card-body">
          <!-- GitHub 配置提示 -->
          <div class="alert alert-info mb-4">
            <i class="bi bi-info-circle"></i>
            <strong>GitHub 配置：</strong>請在 <code>config.js</code> 中配置
            GitHub Token 和 Repository。 如果未配置，系統會下載檔案供手動部署。
            <a href="CONFIG_SETUP.md" target="_blank" class="alert-link"
              >查看設定說明</a
            >
          </div>

          <!-- 產品表單 -->
          <form id="productForm">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="productId" class="form-label"
                    >產品 ID <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="productId"
                    required
                    placeholder="例如: NEW1"
                  />
                  <small class="form-text text-muted"
                    >唯一識別碼，建議使用英文和數字</small
                  >
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="productName" class="form-label"
                    >產品名稱 <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="productName"
                    required
                    placeholder="例如: 新產品名稱"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="productCategory" class="form-label"
                    >產品類別 <span class="text-danger">*</span></label
                  >
                  <select class="form-select" id="productCategory" required>
                    <option value="">請選擇類別</option>
                    <option value="tools">省工機具</option>
                    <option value="smart-detection">智能檢測儀器</option>
                    <option value="biosecurity">生物安全防治設備</option>
                    <option value="animal-marking">動物標示</option>
                    <option value="injection">注射防疫</option>
                    <option value="temperature">環溫控制</option>
                    <option value="disinfection">清洗消毒</option>
                    <option value="epidemicPrevention">豬場防疫</option>
                    <option value="equipment">養殖器械</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="productDescription" class="form-label"
                    >產品描述 <span class="text-danger">*</span></label
                  >
                  <textarea
                    class="form-control"
                    id="productDescription"
                    rows="3"
                    required
                    placeholder="簡短的產品描述"
                  ></textarea>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="metaDescription" class="form-label">SEO 描述</label>
              <textarea
                class="form-control"
                id="metaDescription"
                rows="2"
                placeholder="用於搜尋引擎優化"
              ></textarea>
            </div>

            <div class="mb-3">
              <label for="keywords" class="form-label">關鍵字</label>
              <input
                type="text"
                class="form-control"
                id="keywords"
                placeholder="關鍵字1 關鍵字2 關鍵字3"
              />
            </div>

            <!-- 產品規格 -->
            <div class="mb-3">
              <label class="form-label">產品規格</label>
              <div id="specsContainer">
                <!-- 規格項目將動態添加 -->
              </div>
              <button
                type="button"
                class="btn btn-sm btn-outline-primary"
                onclick="addSpec()"
              >
                <i class="bi bi-plus"></i> 新增規格
              </button>
            </div>

            <!-- 產品圖片 -->
            <div class="mb-3">
              <label class="form-label">產品圖片</label>
              <input
                type="file"
                class="form-control"
                id="productImages"
                multiple
                accept="image/*"
                onchange="handleImageUpload(event)"
              />
              <small class="form-text text-muted"
                >可上傳多張圖片（JPG、PNG）</small
              >
              <div id="imagePreview" class="mt-3"></div>
            </div>

            <!-- 下載檔案 -->
            <!-- <div class="mb-3">
              <label class="form-label">下載檔案（可選）</label>
              <div id="downloadsContainer">
              </div>
              <button
                type="button"
                class="btn btn-sm btn-outline-primary"
                onclick="addDownload()"
              >
                <i class="bi bi-plus"></i> 新增下載
              </button>
            </div> -->

            <!-- 影片連結 -->
            <div class="mb-3">
              <label for="videoUrl" class="form-label">YouTube 影片連結</label>
              <input
                type="url"
                class="form-control"
                id="videoUrl"
                placeholder="https://youtu.be/影片ID"
              />
            </div>

            <!-- 提交按鈕 -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="previewData()"
              >
                <i class="bi bi-eye"></i> 預覽資料
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="saveProduct()"
              >
                <i class="bi bi-save"></i> 儲存產品
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- 預覽 Modal -->
      <div
        class="modal fade"
        id="previewModal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">資料預覽</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <pre id="previewContent" class="bg-light p-3"></pre>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                關閉
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
      // 登入驗證
      const ADMIN_CREDENTIALS = {
        username: 'witega',
        password: '83405528'
      };

      // 檢查登入狀態
      function checkAuth() {
        const isAuthenticated =
          sessionStorage.getItem('admin_authenticated') === 'true';
        if (isAuthenticated) {
          document.getElementById('loginForm').style.display = 'none';
          document.getElementById('adminContent').style.display = 'block';
        } else {
          document.getElementById('loginForm').style.display = 'block';
          document.getElementById('adminContent').style.display = 'none';
        }
      }

      // 處理登入
      function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('loginError');

        if (
          username === ADMIN_CREDENTIALS.username &&
          password === ADMIN_CREDENTIALS.password
        ) {
          // 登入成功
          sessionStorage.setItem('admin_authenticated', 'true');
          errorDiv.style.display = 'none';
          checkAuth();
        } else {
          // 登入失敗
          errorDiv.textContent = '帳號或密碼錯誤';
          errorDiv.style.display = 'block';
          document.getElementById('password').value = '';
        }
      }

      // 處理登出
      function handleLogout() {
        if (confirm('確定要登出嗎？')) {
          sessionStorage.removeItem('admin_authenticated');
          checkAuth();
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
        }
      }

      // 頁面載入時檢查登入狀態
      document.addEventListener('DOMContentLoaded', function () {
        checkAuth();
      });
    </script>
    <script src="config.js"></script>
    <script src="github-deploy.js"></script>
    <script src="admin.js"></script>
  </body>
</html>
